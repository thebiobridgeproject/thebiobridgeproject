  <script>
    const resourceForm = document.getElementById('resourceForm');
    const resourcesList = document.getElementById('resourcesList');
    const emptyNote = document.getElementById('emptyNote');

    const API_URL = 'https://script.google.com/macros/s/AKfycbzxmfEHqpeyeMHXiYt7PE-UqUZnKS8vwOOgYXbNaKlN1M0tTbKLncz3GLUXREPJoeGr/exec';

    let resources = [];

    function renderResources() {
      resourcesList.innerHTML = '';
      if (resources.length === 0) {
        emptyNote.style.display = 'block';
      } else {
        emptyNote.style.display = 'none';
        resources.forEach(res => {
          const div = document.createElement('div');
          div.className = 'resource-item';
          div.innerHTML = `
            <h4>${escapeHTML(res.name)}</h4>
            <p>${escapeHTML(res.desc)}</p>
            <a href="${escapeHTML(res.link)}" target="_blank">${escapeHTML(res.link)}</a>
          `;
          resourcesList.appendChild(div);
        });
      }
    }

    function escapeHTML(str) {
      return str.replace(/[&<>\"']/g, function(m) {
        return {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        }[m];
      });
    }

    async function fetchResources() {
      try {
        const res = await fetch(API_URL + '?action=getResources');
        if (!res.ok) throw new Error('Failed to fetch resources');
        resources = await res.json();
      } catch (e) {
        resources = [];
      }
      renderResources();
    }

    resourceForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('resourceName').value.trim();
      const link = document.getElementById('resourceLink').value.trim();
      const desc = document.getElementById('resourceDesc').value.trim();

      if (!/^https?:\/\//i.test(link)) {
        alert('Please enter a valid URL starting with http:// or https://');
        return;
      }

      try {
        await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, link, desc })
        });
        resourceForm.reset();
        await fetchResources();
      } catch (err) {
        alert('Failed to submit resource. Please try again.');
      }
    });

    fetchResources();
  </script>
